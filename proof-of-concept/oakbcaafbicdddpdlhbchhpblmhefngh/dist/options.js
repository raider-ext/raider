(()=>{"use strict";var e,t,n,o,r,s,a,l,i;!function(e){e.On="on",e.Off="off",e.Auto="auto"}(e||(e={})),function(e){e.Off="off",e.Fullscreen="fullscreen",e.On="on"}(t||(t={})),function(e){e.Visible="visible",e.Hidden="hidden"}(n||(n={})),function(e){e.Error="error",e.Warn="warn",e.Info="info",e.Debug="debug",e.Trace="trace"}(o||(o={})),function(e){e.Window="window",e.Opaque="opaque",e.Transparent="transparent",e.Direct="direct",e.Gpu="gpu"}(r||(r={})),function(e){e.WebGpu="webgpu",e.WgpuWebgl="wgpu-webgl",e.Webgl="webgl",e.Canvas="canvas"}(s||(s={})),function(e){e.On="on",e.RightClickOnly="rightClickOnly",e.Off="off"}(a||(a={})),function(e){e.Allow="allow",e.Confirm="confirm",e.Deny="deny"}(l||(l={})),function(e){e.All="all",e.Internal="internal",e.None="none"}(i||(i={}));const c={allowScriptAccess:!1,parameters:{},autoplay:e.Auto,backgroundColor:null,letterbox:t.Fullscreen,unmuteOverlay:n.Visible,upgradeToHttps:!0,compatibilityRules:!0,favorFlash:!0,warnOnUnsupportedContent:!0,logLevel:o.Error,showSwfDownload:!1,contextMenu:a.On,preloader:!0,splashScreen:!0,maxExecutionDuration:15,base:null,menu:!0,salign:"",forceAlign:!1,quality:"high",scale:"showAll",forceScale:!1,frameRate:null,wmode:r.Opaque,publicPath:null,polyfills:!0,playerVersion:null,preferredRenderer:null,openUrlMode:l.Allow,allowNetworking:i.All,openInNewTab:null,socketProxy:[],fontSources:[],defaultFonts:{}},u=Object.assign(Object.assign({},c),{ruffleEnable:!0,ignoreOptout:!1,autostart:!1});let d,g,f,p,m,b;function h(e){return new Promise(((t,n)=>{e((e=>{const o=chrome.runtime.lastError;o?n(o):t(e)}))}))}function w(e){return{clear:()=>h((t=>e.clear(t))),get:t=>h((n=>e.get(t||null,n))),remove:t=>h((n=>e.remove(t,n))),set:t=>h((n=>e.set(t,n)))}}if("undefined"!=typeof chrome)d=chrome.i18n,g={local:w(chrome.storage.local),sync:w(chrome.storage.sync),onChanged:{addListener:e=>chrome.storage.onChanged.addListener(e)}},f={reload:e=>h((t=>chrome.tabs.reload(e,void 0,t))),query:e=>h((t=>chrome.tabs.query(e,t))),sendMessage:(e,t,n)=>h((o=>chrome.tabs.sendMessage(e,t,n||{},o)))},p=chrome.runtime,m=()=>h((e=>chrome.tabs.create({url:"/options.html"},e))),b=()=>h((e=>chrome.tabs.create({url:"/player.html"})));else{if("undefined"==typeof browser)throw new Error("Extension API not found.");d=browser.i18n,g=browser.storage,f=browser.tabs,p=browser.runtime,m=()=>browser.runtime.openOptionsPage(),b=()=>h((e=>browser.tabs.create({url:"/player.html"})))}async function y(){const e=await g.sync.get();return Object.assign(Object.assign({},u),e)}class v{constructor(e,t){this.checkbox=e,this.label=t}get input(){return this.checkbox}get value(){return this.checkbox.checked}set value(e){this.checkbox.checked=e}}class O{constructor(e,t){this.numberInput=e,this.label=t,this.numberInput.addEventListener("input",(()=>{this.numberInput.reportValidity()}))}get input(){return this.numberInput}get value(){const e=this.numberInput,t=e.valueAsNumber;if(Number.isNaN(t))return null;if(e.min){const n=Number(e.min);if(n>t)return n}if(e.max){const n=Number(e.max);if(t>n)return n}return t}set value(e){var t;this.numberInput.value=null!==(t=null==e?void 0:e.toString())&&void 0!==t?t:""}}class x{constructor(e,t){this.select=e,this.label=t,Array.prototype.forEach.call(e.options,(e=>{if(e.hasAttribute("id")){const t=d.getMessage(`settings_${e.id}`);t&&(e.textContent=t)}}))}get input(){return this.select}get value(){const e=this.select.selectedIndex;return this.select.options[e].value||null}set value(e){null!=e||(e="");const t=Array.from(this.select.options).findIndex((t=>t.value===e));this.select.selectedIndex=t}}function E(e){const t=e.getElementsByTagName("label")[0],[n]=e.getElementsByTagName("input");if(n){if("checkbox"===n.type)return new v(n,t);if("number"===n.type)return new O(n,t)}const[o]=e.getElementsByTagName("select");if(o)return new x(o,t);throw new Error("Unknown option element")}async function C(e){const t=function(){const e=new Map;for(const t of document.getElementsByClassName("option")){const n=E(t),o=n.input.id.replace(/[^a-z\d](.)/gi,((e,t)=>t.toUpperCase()));e.set(o,n)}return e}(),n=await y();for(const[e,o]of t.entries()){o.value=n[e],o.label.classList.add("notransition"),o.label.offsetHeight,o.label.classList.remove("notransition");const t=d.getMessage(`settings_${o.input.id}`);t&&(o.label.textContent=t),o.input.addEventListener("change",(()=>{const t=o.value;n[e]=t,g.sync.set({[e]:t})}))}g.onChanged.addListener(((o,r)=>{if("sync"===r){for(const[e,r]of Object.entries(o)){const o=t.get(e);o&&(o.value=r.newValue,n[e]=r.newValue)}e&&e(n)}})),e&&e(n)}window.addEventListener("DOMContentLoaded",(()=>{document.title=d.getMessage("settings_page");document.getElementById("advanced_options").textContent=d.getMessage("settings_advanced_options");{const e=document.getElementById("reset_settings");e.textContent=d.getMessage("settings_reset"),e.addEventListener("click",(async()=>{confirm(d.getMessage("settings_reset_confirm"))&&(await async function(){g.sync.clear()}(),window.location.reload())}))}C()}))})();