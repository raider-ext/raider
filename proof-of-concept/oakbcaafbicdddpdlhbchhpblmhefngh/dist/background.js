(()=>{"use strict";var e,n,r,t,o,l,a,i,s;!function(e){e.On="on",e.Off="off",e.Auto="auto"}(e||(e={})),function(e){e.Off="off",e.Fullscreen="fullscreen",e.On="on"}(n||(n={})),function(e){e.Visible="visible",e.Hidden="hidden"}(r||(r={})),function(e){e.Error="error",e.Warn="warn",e.Info="info",e.Debug="debug",e.Trace="trace"}(t||(t={})),function(e){e.Window="window",e.Opaque="opaque",e.Transparent="transparent",e.Direct="direct",e.Gpu="gpu"}(o||(o={})),function(e){e.WebGpu="webgpu",e.WgpuWebgl="wgpu-webgl",e.Webgl="webgl",e.Canvas="canvas"}(l||(l={})),function(e){e.On="on",e.RightClickOnly="rightClickOnly",e.Off="off"}(a||(a={})),function(e){e.Allow="allow",e.Confirm="confirm",e.Deny="deny"}(i||(i={})),function(e){e.All="all",e.Internal="internal",e.None="none"}(s||(s={}));const c={allowScriptAccess:!1,parameters:{},autoplay:e.Auto,backgroundColor:null,letterbox:n.Fullscreen,unmuteOverlay:r.Visible,upgradeToHttps:!0,compatibilityRules:!0,favorFlash:!0,warnOnUnsupportedContent:!0,logLevel:t.Error,showSwfDownload:!1,contextMenu:a.On,preloader:!0,splashScreen:!0,maxExecutionDuration:15,base:null,menu:!0,salign:"",forceAlign:!1,quality:"high",scale:"showAll",forceScale:!1,frameRate:null,wmode:o.Opaque,publicPath:null,polyfills:!0,playerVersion:null,preferredRenderer:null,openUrlMode:i.Allow,allowNetworking:s.All,openInNewTab:null,socketProxy:[],fontSources:[],defaultFonts:{}},u=Object.assign(Object.assign({},c),{ruffleEnable:!0,ignoreOptout:!1,autostart:!1});let p,f,d,m,h,g;function w(e){return new Promise(((n,r)=>{e((e=>{const t=chrome.runtime.lastError;t?r(t):n(e)}))}))}function b(e){return{clear:()=>w((n=>e.clear(n))),get:n=>w((r=>e.get(n||null,r))),remove:n=>w((r=>e.remove(n,r))),set:n=>w((r=>e.set(n,r)))}}if("undefined"!=typeof chrome)p=chrome.i18n,f={local:b(chrome.storage.local),sync:b(chrome.storage.sync),onChanged:{addListener:e=>chrome.storage.onChanged.addListener(e)}},d={reload:e=>w((n=>chrome.tabs.reload(e,void 0,n))),query:e=>w((n=>chrome.tabs.query(e,n))),sendMessage:(e,n,r)=>w((t=>chrome.tabs.sendMessage(e,n,r||{},t)))},m=chrome.runtime,h=()=>w((e=>chrome.tabs.create({url:"/options.html"},e))),g=()=>w((e=>chrome.tabs.create({url:"/player.html"})));else{if("undefined"==typeof browser)throw new Error("Extension API not found.");p=browser.i18n,f=browser.storage,d=browser.tabs,m=browser.runtime,h=()=>browser.runtime.openOptionsPage(),g=()=>w((e=>browser.tabs.create({url:"/player.html"})))}async function y(){const e=await f.local.get();return Object.assign(Object.assign({},u),e)}async function O(){return(await chrome.scripting.getRegisteredContentScripts({ids:["plugin-polyfill"]})).length>0}async function v(){(null===chrome||void 0===chrome?void 0:chrome.scripting)&&!await O()&&await chrome.scripting.registerContentScripts([{id:"plugin-polyfill",js:["dist/pluginPolyfill.js"],persistAcrossSessions:!0,matches:["<all_urls>"],excludeMatches:["https://sso.godaddy.com/*","https://authentication.td.com/*","https://*.twitch.tv/*","https://www.tuxedocomputers.com/*","https://*.taobao.com/*"],runAt:"document_start",world:"MAIN"}])}function A(e,n,r){void 0!==e.type&&"open_url_in_player"===e.type&&chrome.tabs.create({url:m.getURL(`player.html#${e.url}`)})}(async()=>{const{ruffleEnable:e}=await y();e&&await v()})(),(null===chrome||void 0===chrome?void 0:chrome.runtime)&&!chrome.runtime.onMessage.hasListener(A)&&chrome.runtime.onMessage.addListener(A),f.onChanged.addListener((async(e,n)=>{"ruffleEnable"in e&&(e.ruffleEnable.newValue?await v():await async function(){(null===chrome||void 0===chrome?void 0:chrome.scripting)&&await O()&&await chrome.scripting.unregisterContentScripts({ids:["plugin-polyfill"]})}())}))})();