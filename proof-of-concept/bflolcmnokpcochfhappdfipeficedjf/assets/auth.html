<html>
<head>
  <title>Sample Login Page</title>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
<script src="https://sdk.amazonaws.com/js/aws-sdk-2.3.7.min.js"></script>
<h1>Sample Login Page</h1>
<div id="info">
  Login
</div>
<table>
  <tr>
    <td>Password</td>
    <td><input type="password" id="password" size="20">
  </tr>
  <tr>
    <td colspan="2">
      <button type="submit" id="login-button">Login</button>
    </td>
  </tr>
</table>
<script>
  AWS.config.update({region: 'eu-west-1'});
  var lambda = new AWS.Lambda({accessKeyId: 'ACCESS_KEY',
    secretAccessKey: 'SECRET_KEY'});
  var password = document.getElementById('password');
  var loginButton = document.getElementById('login-button');

  loginButton.addEventListener('click', function() {
    info.innerHTML = 'Login...';

    if (password.value == null || password.value == '') {
      info.innerHTML = 'Please specify a password.';

    } else {
      var input = {
        password: password.value
      };

      lambda.invoke({
          FunctionName: 'basicAuth',
          Payload: JSON.stringify(input)
        },
        function(err, data) {
          if (err) console.log(err, err.stack);
          else {
            var output = JSON.parse(data.Payload);

            if (output.code == 403) {
              info.innerHTML = 'Access denied';
            } else {
              window.location.replace(output.url);
            }
          }
        });
    }
  });
</script>
</body>
</html>
